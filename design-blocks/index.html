<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Program Evaluation Generator</title>
    <!-- Replace the URLs with Google's CDN -->
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="custom_blocks.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Student Program Evaluation Generator</h1>
    </header>
    <main>
        <a href="https://github.com/odchilvers/chilvers-vetica-group-project-CPSC354">GitHub Source</a>
        <section id="input-section">
            <h2>Student Information</h2>
            <div id="blocklyDiv" style="height: 400px; width: 100%;"></div>
            <button onclick="generateCode()">Generate Code</button>
            <button onclick="generatePlan()">Generate Four-Year Plan</button>
            <button onclick="saveCode()">Save Code</button>
        </section>

        <section id="output-section">
            <h2>Code</h2>
            <div id="code-generate-box">
                <!-- Generated code goes here -->
            </div>
            <h2>Four-Year Plan</h2>
            <div id="four-year-plan">
                <!-- Generated four-year plan goes here -->
            </div>
            <h2>Saved Code</h2>
            <div id="save-code-button">
                <!-- Generated four-year plan goes here -->
            </div>
        </section>
    </main>

    <!-- Define the Blockly toolbox with custom blocks -->
    <xml id="toolbox" style="display: none">
        <!-- Custom Blocks Category -->
        <category name="Custom Blocks" colour="230">
            <!-- Add Course Block -->
            <block type="add_course"></block>

            <!-- Find Course Block -->
            <block type="find_course"></block>
            
            <!-- Update Course Block -->
            <block type="update_course"></block>
            
            <!-- Delete Course Block -->
            <block type="delete_course"></block>
            
            <!-- Generate Plan Block -->
            <!-- <block type="generate_plan"></block>

            !-- Generate Code Block --
            <block type="generate_code"></block> -->

        </category>
        
        <!-- Other Toolbox Categories (if needed) -->
        </xml>

    <footer>
        <p>&copy; 2023 Student Program Evaluation Generator</p>
    </footer>

    <script>
        // Initialize Blockly
        var workspace = Blockly.inject('blocklyDiv', {
            toolbox: document.getElementById('toolbox'),
            scrollbars: true
        });


        // Define custom Blockly blocks based on your DSL
        Blockly.Blocks['add_block'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("ADD")
                    .appendField(new Blockly.FieldDropdown([["Course", "Course"]]), "ENTITY")
                    .appendField("with data:");
                this.appendValueInput("DATA")
                    .setCheck("Course");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour(230);
                this.setTooltip("Add a new course to the database");
                this.setHelpUrl("");
            }
        };

        Blockly.Blocks['find_block'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("FIND")
                    .appendField(new Blockly.FieldDropdown([["Course", "Course"]]), "ENTITY")
                    .appendField("where")
                    .appendField(new Blockly.FieldTextInput("code"), "CRITERIA")
                    .appendField("=");
                this.setOutput(true, "Course");
                this.setColour(230);
                this.setTooltip("Retrieve information from the database");
                this.setHelpUrl("");
            }
        };

        Blockly.Blocks['update_block'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("UPDATE")
                    .appendField(new Blockly.FieldDropdown([["Course", "Course"]]), "ENTITY")
                    .appendField("where")
                    .appendField(new Blockly.FieldTextInput("code"), "CRITERIA")
                    .appendField("with data:");
                this.appendValueInput("DATA")
                    .setCheck("Course");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour(230);
                this.setTooltip("Update course information in the database");
                this.setHelpUrl("");
            }
        };

        // Define other custom Blockly blocks (DELETE, CHECK_PREREQUISITE, CHECK_IF_TAKEN, GENERATE) here

        // Generate function for demonstration
        function generateCode() {
            // Retrieve and process Blockly code to generate the four-year plan
            var code = Blockly.JavaScript.workspaceToCode(workspace);
            // Implement logic to generate the four-year plan based on the code (not shown here).
            // Display the generated plan in the output section.
            document.getElementById('code-generate-box').innerText = code;
        }

        // Generate function for demonstration
        function generatePlan() {
            // Retrieve and process Blockly code to generate the four-year plan
            var code = Blockly.JavaScript.workspaceToCode(workspace);
            // Implement logic to generate the four-year plan based on the code (not shown here).
            // Display the generated plan in the output section.
            document.getElementById('four-year-plan').innerText = "Generated plan will appear here.";
        }

        // Function to save code as a file
        function saveCode() {
            // Retrieve the generated code
            var code = Blockly.JavaScript.workspaceToCode(workspace);

            // Create a Blob object to store the code content
            var blob = new Blob([code], { type: 'text/javascript' });

            // Create a temporary URL for the Blob
            var url = URL.createObjectURL(blob);

            // Create an anchor element to trigger the download
            var a = document.createElement('a');
            a.href = url;
            a.download = 'generated_code.js'; // Specify the filename here

            // Programmatically click the anchor element to trigger the download
            a.click();

            // Release the Blob URL
            URL.revokeObjectURL(url);

            // Add a click event listener to the "Save Code" button
            document.getElementById('save-code-button').addEventListener('click', saveCodeToFile);
        }

    </script>

</body>
</html>
